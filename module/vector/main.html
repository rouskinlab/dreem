<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vectorization &mdash; dreem 28.02.2023 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Aggregation" href="../aggregate/main.html" />
    <link rel="prev" title="Alignment" href="../align/main.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> dreem
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/main.html"><strong>Overview</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DREEM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dreem/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dreem/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dreem/reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dreem/IO.html">I/O files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dreem/formats/main.html">Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dreem/dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dreem/data.html">Download a test dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dreem/Logs.html">Logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plots</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plots/get_started.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plots/gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plots/create_a_plot.html">Write your own plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../align/main.html">Alignment</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vectorization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cli">CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#api-reference">API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#command-line-interface">Command line interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dreem-vector">dreem vector</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#python-interface">Python interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#i-o-files">I/O files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#key-algorithm-s">Key algorithm(s)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-sam-files-to-vectorize">Create SAM files to vectorize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-batches-of-reads">Define batches of reads</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parse-cigar-strings-into-vectors">Parse CIGAR strings into vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#find-ambiguous-mutations">Find ambiguous mutations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-output-files">Write output files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#edge-cases-handling">Edge cases handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../aggregate/main.html">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../draw/main.html">Drawing (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster/main.html">Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demultiplex/main.html">Demultiplexing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/dms.html">DMS-MaPseq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/dreem.html">DREEM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dreem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Vectorization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/module/vector/main.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vectorization">
<h1>Vectorization<a class="headerlink" href="#vectorization" title="Permalink to this headline"></a></h1>
<p>The vectorization module determines whether each base in each sequencing read matches the reference RNA sequence.
It outputs a matrix in which each column is a base in the reference sequence, each row is a read,
and each element is a byte indicating the relationship between the bases in the read and reference sequences.
This matrix can then be used to calculate mutation frequencies or to cluster the reads to find alternative structures.</p>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline"></a></h2>
<section id="cli">
<h3>CLI<a class="headerlink" href="#cli" title="Permalink to this headline"></a></h3>
<p>Basic usage showing how to create mutation vectors from the BAM file <code class="docutils literal notranslate"><span class="pre">DMS_100mM/MAPT-3R.bam</span></code>
over section 231 - 417 of the transcript named “MAPT-3R”,
with the reference sequence defined in <code class="docutils literal notranslate"><span class="pre">human_transcriptome.fasta</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dreem</span> <span class="n">vector</span> <span class="o">-</span><span class="n">b</span> <span class="n">DMS_100mM</span><span class="o">/</span><span class="n">MAPT</span><span class="o">-</span><span class="mi">3</span><span class="n">R</span><span class="o">.</span><span class="n">bam</span> <span class="o">-</span><span class="n">f</span> <span class="n">human_transcriptome</span><span class="o">.</span><span class="n">fasta</span> <span class="o">-</span><span class="n">c</span> <span class="n">MAPT</span><span class="o">-</span><span class="mi">3</span><span class="n">R</span> <span class="mi">231</span> <span class="mi">417</span>
</pre></div>
</div>
</section>
<section id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline"></a></h3>
<p>Basic usage of the Python API to perform the same operation as shown in the CLI example.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dreem</span> <span class="kn">import</span> <span class="n">vector</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">report_files</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bamf</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;DMS_100mM/MAPT-3R.bam&quot;</span><span class="p">,),</span>
<span class="gp">... </span>                               <span class="n">fasta</span><span class="o">=</span><span class="s2">&quot;human_transcriptome.fasta&quot;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">coords</span><span class="o">=</span><span class="p">((</span><span class="s2">&quot;MAPT-3R&quot;</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">417</span><span class="p">),))</span>
</pre></div>
</div>
</section>
</section>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline"></a></h2>
<p><em>The arguments for the CLI and Python API are the same. The CLI is just a wrapper around the Python API.</em></p>
<section id="command-line-interface">
<h3>Command line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline"></a></h3>
<section id="dreem-vector">
<h4>dreem vector<a class="headerlink" href="#dreem-vector" title="Permalink to this headline"></a></h4>
<p>Hook the command line interface to the <code class="docutils literal notranslate"><span class="pre">`run`</span></code> function.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dreem vector <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-fasta">
<span class="sig-name descname"><span class="pre">--fasta</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;fasta&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-fasta" title="Permalink to this definition"></a></dt>
<dd><p>FASTA file of all reference sequences in the project</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-bamf">
<span class="sig-name descname"><span class="pre">--bamf</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;bamf&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-bamf" title="Permalink to this definition"></a></dt>
<dd><p>BAM file</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-bamd">
<span class="sig-name descname"><span class="pre">--bamd</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;bamd&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-bamd" title="Permalink to this definition"></a></dt>
<dd><p>Directory of BAM files</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-library">
<span class="sig-name descname"><span class="pre">--library</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;library&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-library" title="Permalink to this definition"></a></dt>
<dd><p>Library CSV file</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-autosect">
<span id="cmdoption-dreem-vector-no-autosect"></span><span class="sig-name descname"><span class="pre">--autosect</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--no-autosect</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dreem-vector-autosect" title="Permalink to this definition"></a></dt>
<dd><p>Whether, for every reference that was not explicitly given at least one section (by –initial_coords or –primers), to generate coordinates covering the entire reference sequence automatically</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-c">
<span id="cmdoption-dreem-vector-coords"></span><span class="sig-name descname"><span class="pre">-c</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--coords</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;coords&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-c" title="Permalink to this definition"></a></dt>
<dd><p>Reference name, 5’ end, and 3’ end of a section; coordinates are 1-indexed and include both ends</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-p">
<span id="cmdoption-dreem-vector-primers"></span><span class="sig-name descname"><span class="pre">-p</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--primers</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;primers&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-p" title="Permalink to this definition"></a></dt>
<dd><p>Reference name, forward primer, and reverse primer of a section; reverse primer must be given 5’ to 3’</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-primer-gap">
<span class="sig-name descname"><span class="pre">--primer-gap</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;primer_gap&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-primer-gap" title="Permalink to this definition"></a></dt>
<dd><p>Number of bases to leave as a gap between the end of a primer and the end of the section</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-out-dir">
<span class="sig-name descname"><span class="pre">--out-dir</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;out_dir&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-out-dir" title="Permalink to this definition"></a></dt>
<dd><p>Where to output all finished files</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-temp-dir">
<span class="sig-name descname"><span class="pre">--temp-dir</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;temp_dir&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-temp-dir" title="Permalink to this definition"></a></dt>
<dd><p>Where to write all temporary files</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-phred-enc">
<span class="sig-name descname"><span class="pre">--phred-enc</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;phred_enc&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-phred-enc" title="Permalink to this definition"></a></dt>
<dd><p>Phred score encoding in FASTQ/SAM/BAM files</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-min-phred">
<span class="sig-name descname"><span class="pre">--min-phred</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;min_phred&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-min-phred" title="Permalink to this definition"></a></dt>
<dd><p>Minimum Phred score to use a base call</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-ambid">
<span id="cmdoption-dreem-vector-no-ambid"></span><span class="sig-name descname"><span class="pre">--ambid</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--no-ambid</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dreem-vector-ambid" title="Permalink to this definition"></a></dt>
<dd><p>Whether to find and label all ambiguous insertions and deletions (improves accuracy but runs slower)</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-strict-pairs">
<span id="cmdoption-dreem-vector-no-strict-pairs"></span><span class="sig-name descname"><span class="pre">--strict-pairs</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--no-strict-pairs</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dreem-vector-strict-pairs" title="Permalink to this definition"></a></dt>
<dd><p>Whether to require that every paired read that maps to a section also have a mate that maps to the section</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-z">
<span id="cmdoption-dreem-vector-batch-size"></span><span class="sig-name descname"><span class="pre">-z</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--batch-size</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;batch_size&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-z" title="Permalink to this definition"></a></dt>
<dd><p>Maximum size of each batch of mutation vectors, in millions of base calls</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-max-procs">
<span class="sig-name descname"><span class="pre">--max-procs</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;max_procs&gt;</span></span><a class="headerlink" href="#cmdoption-dreem-vector-max-procs" title="Permalink to this definition"></a></dt>
<dd><p>Maximum number of simultaneous processes</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-parallel">
<span id="cmdoption-dreem-vector-no-parallel"></span><span class="sig-name descname"><span class="pre">--parallel</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--no-parallel</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dreem-vector-parallel" title="Permalink to this definition"></a></dt>
<dd><p>Whether to run multiple jobs in parallel</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-rerun">
<span id="cmdoption-dreem-vector-no-rerun"></span><span class="sig-name descname"><span class="pre">--rerun</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--no-rerun</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dreem-vector-rerun" title="Permalink to this definition"></a></dt>
<dd><p>Whether to regenerate files that already exist</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dreem-vector-save-temp">
<span id="cmdoption-dreem-vector-erase-temp"></span><span class="sig-name descname"><span class="pre">--save-temp</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--erase-temp</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dreem-vector-save-temp" title="Permalink to this definition"></a></dt>
<dd><p>Whether to save or erase temporary files after the program exits</p>
</dd></dl>

</section>
</section>
<section id="python-interface">
<h3>Python interface<a class="headerlink" href="#python-interface" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">dreem.vector.</span></span><span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fasta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bamf</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bamd</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">library</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">autosect</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">primers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">primer_gap</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'./output'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temp_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'./temp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phred_enc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_phred</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ambid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict_pairs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">32.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_procs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rerun</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_temp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><dl class="simple">
<dt>Run the vectoring step. Generate a vector encoding mutations for</dt><dd><p>each read (or read pair, if paired-end).</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fasta</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – FASTA file of all reference sequences in the project [positional or keyword]</p></li>
<li><p><strong>bamf</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>) – BAM file [keyword-only, default: ()]</p></li>
<li><p><strong>bamd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>) – Directory of BAM files [keyword-only, default: ()]</p></li>
<li><p><strong>library</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – Library CSV file [keyword-only, default: ‘’]</p></li>
<li><p><strong>autosect</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – Whether, for every reference that was not explicitly given at least one section (by –initial_coords or –primers), to generate coordinates covering the entire reference sequence automatically [keyword-only, default: False]</p></li>
<li><p><strong>coords</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>) – Reference name, 5’ end, and 3’ end of a section; coordinates are 1-indexed and include both ends [keyword-only, default: ()]</p></li>
<li><p><strong>primers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>) – Reference name, forward primer, and reverse primer of a section; reverse primer must be given 5’ to 3’ [keyword-only, default: ()]</p></li>
<li><p><strong>primer_gap</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Number of bases to leave as a gap between the end of a primer and the end of the section [keyword-only, default: 2]</p></li>
<li><p><strong>out_dir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – Where to output all finished files [keyword-only, default: ‘./output’]</p></li>
<li><p><strong>temp_dir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – Where to write all temporary files [keyword-only, default: ‘./temp’]</p></li>
<li><p><strong>phred_enc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Phred score encoding in FASTQ/SAM/BAM files [keyword-only, default: 33]</p></li>
<li><p><strong>min_phred</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Minimum Phred score to use a base call [keyword-only, default: 25]</p></li>
<li><p><strong>ambid</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – Whether to find and label all ambiguous insertions and deletions (improves accuracy but runs slower) [keyword-only, default: True]</p></li>
<li><p><strong>strict_pairs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – Whether to require that every paired read that maps to a section also have a mate that maps to the section [keyword-only, default: True]</p></li>
<li><p><strong>batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>) – Maximum size of each batch of mutation vectors, in millions of base calls [keyword-only, default: 32.0]</p></li>
<li><p><strong>max_procs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Maximum number of simultaneous processes [keyword-only, default: 2]</p></li>
<li><p><strong>parallel</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – Whether to run multiple jobs in parallel [keyword-only, default: True]</p></li>
<li><p><strong>rerun</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – Whether to regenerate files that already exist [keyword-only, default: False]</p></li>
<li><p><strong>save_temp</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – Whether to save or erase temporary files after the program exits [keyword-only, default: False]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="i-o-files">
<h2>I/O files<a class="headerlink" href="#i-o-files" title="Permalink to this headline"></a></h2>
<p><em>This module needs the files to be sorted into a specific folder structure. The folder structure is described below.</em></p>
<p><strong>Input file structure</strong></p>
<p>The module takes one or more files of aligned reads in binary alignment map (BAM) format. Each file must be named after the reference sequence to which it was aligned, end with the file extension <code class="docutils literal notranslate"><span class="pre">.bam</span></code>, and reside in a directory named after the sample from which the reads came:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|-</span> <span class="n">sample_1</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">reference_1</span><span class="o">.</span><span class="n">bam</span>
    <span class="o">|-</span> <span class="n">reference_2</span><span class="o">.</span><span class="n">bam</span>
<span class="o">|-</span> <span class="n">sample_2</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">reference_1</span><span class="o">.</span><span class="n">bam</span>
    <span class="o">|-</span> <span class="n">reference_3</span><span class="o">.</span><span class="n">bam</span>
</pre></div>
</div>
<p><strong>Output file structure</strong></p>
<p>The module outputs one report file (<a class="reference external" href="https://www.json.org/json-en.html">JSON format</a>) and one or more mutation vector batch files (<a class="reference external" href="https://orc.apache.org/docs">Apache ORC format</a>) for each section of each reference for each sample. Each sample corresponds to one directory that contains one sub-directory for each reference to which the sample was aligned. Each reference directory contains one sub-directory for each section of the reference for which mutation vectors were computed. Each section directory contains one or more mutation vector batch files (numbered <code class="docutils literal notranslate"><span class="pre">0.orc</span></code>, <code class="docutils literal notranslate"><span class="pre">1.orc</span></code>, …) and a report file (<code class="docutils literal notranslate"><span class="pre">report.json</span></code>) that contains metadata about the vectors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|-</span> <span class="n">sample_1</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">reference_1</span><span class="o">/</span>
        <span class="o">|-</span> <span class="n">section_1</span><span class="mf">.1</span><span class="o">/</span>
            <span class="o">|-</span> <span class="mf">0.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="mf">1.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="n">report</span><span class="o">.</span><span class="n">json</span>
        <span class="o">|-</span> <span class="n">section_1</span><span class="mf">.2</span>
            <span class="o">|-</span> <span class="mf">0.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="n">report</span><span class="o">.</span><span class="n">json</span>
    <span class="o">|-</span> <span class="n">reference_2</span>
        <span class="o">|-</span> <span class="n">section_2</span><span class="mf">.1</span>
            <span class="o">|-</span> <span class="mf">0.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="mf">1.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="mf">2.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="n">report</span><span class="o">.</span><span class="n">json</span>
<span class="o">|-</span> <span class="n">sample_2</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">reference_1</span><span class="o">/</span>
        <span class="o">|-</span> <span class="n">section_1</span><span class="mf">.1</span><span class="o">/</span>
            <span class="o">|-</span> <span class="mf">0.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="n">report</span><span class="o">.</span><span class="n">json</span>
        <span class="o">|-</span> <span class="n">section_1</span><span class="mf">.2</span>
            <span class="o">|-</span> <span class="mf">0.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="mf">1.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="n">report</span><span class="o">.</span><span class="n">json</span>
    <span class="o">|-</span> <span class="n">reference_3</span><span class="o">/</span>
        <span class="o">|-</span> <span class="n">section_3</span><span class="mf">.1</span><span class="o">/</span>
            <span class="o">|-</span> <span class="mf">0.</span><span class="n">orc</span>
            <span class="o">|-</span> <span class="n">report</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</section>
<section id="key-algorithm-s">
<span id="vector-algos"></span><h2>Key algorithm(s)<a class="headerlink" href="#key-algorithm-s" title="Permalink to this headline"></a></h2>
<section id="create-sam-files-to-vectorize">
<h3>Create SAM files to vectorize<a class="headerlink" href="#create-sam-files-to-vectorize" title="Permalink to this headline"></a></h3>
<p>Purpose: In order to turn BAM files into mutation vectors, the BAM files must be converted into SAM files containing only reads that align to the references and sections of interest.</p>
<ol class="arabic simple">
<li><p>For each pair of 5’/3’ coordinates (<code class="docutils literal notranslate"><span class="pre">--coords</span></code>) or forward/reverse primers (<code class="docutils literal notranslate"><span class="pre">--primers</span></code>) given for every reference, a <em>section</em> (i.e. subsequence between two coordinates) of its reference is defined.</p></li>
<li><p>If the option <code class="docutils literal notranslate"><span class="pre">--autosect</span></code> (CLI) or <code class="docutils literal notranslate"><span class="pre">autosect=True</span></code> (API) is given, then for every reference for which no coordinates/primers were given, a section equal to the full reference sequence is defined automatically.</p></li>
<li><p>For each given BAM file (i.e. alignment of a sample to a reference sequence), and for each section defined for its reference sequence, a temporary SAM file of only the reads aligning to the section is generated using <code class="docutils literal notranslate"><span class="pre">samtools</span></code>.</p></li>
</ol>
<p>In the following steps, each temporary SAM file is then processed independently, either in parallel (with Python’s <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> module) or in series.</p>
</section>
<section id="define-batches-of-reads">
<h3>Define batches of reads<a class="headerlink" href="#define-batches-of-reads" title="Permalink to this headline"></a></h3>
<p>Purpose: memory and parallelization</p>
<ol class="arabic simple">
<li></li>
</ol>
</section>
<section id="parse-cigar-strings-into-vectors">
<h3>Parse CIGAR strings into vectors<a class="headerlink" href="#parse-cigar-strings-into-vectors" title="Permalink to this headline"></a></h3>
</section>
<section id="find-ambiguous-mutations">
<h3>Find ambiguous mutations<a class="headerlink" href="#find-ambiguous-mutations" title="Permalink to this headline"></a></h3>
</section>
<section id="write-output-files">
<h3>Write output files<a class="headerlink" href="#write-output-files" title="Permalink to this headline"></a></h3>
</section>
</section>
<section id="edge-cases-handling">
<h2>Edge cases handling<a class="headerlink" href="#edge-cases-handling" title="Permalink to this headline"></a></h2>
<p>[What are the edge cases that need to be handled?
How are they handled?]</p>
<p><strong>Contributors</strong>: Matthew Allan</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../align/main.html" class="btn btn-neutral float-left" title="Alignment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../aggregate/main.html" class="btn btn-neutral float-right" title="Aggregation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Rouskin Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>